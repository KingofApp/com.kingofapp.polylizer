<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../concept-loader.html">
<link rel="import" href="../../template/koapp-theme-bootstrap/koapp-theme-bootstrap.html">

<dom-module id="module-bootstrapmenu">
  <template>
    <link rel="stylesheet" href="../../../bower_components/bootstrap/dist/css/bootstrap.css">

    <style>
      :host {
        display: block;
        min-height: 60px;
      }

      :host .navbar {
        padding: 0 !important;
        border-radius: 0!important;
      }

      :host .navbar-inverse {
        border-color: transparent!important;
      }


    </style>

    <nav class="navbar navbar-toggleable-md navbar-inverse bg-primary">
      <koa-toolbar>
        <!-- TODO: backbutton -->
        <!-- <koa-icon-button icon="menu" hidden$="[!showBack]" data-toggle="collapse" data-target="#navbarSupportedContent"></koa-icon-button> -->
        <koa-icon-button on-click="displayMenu" data-toggle="collapse" icon="menu"></koa-icon-button>
        <span class='title text-center'>[[rootName]]</span>
      </koa-toolbar>

      <!-- <a class="navbar-brand" href="#"></a> -->
    <!-- Brand and toggle get grouped for better mobile display -->


      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class$="collapse navbar-collapse" id="menuCollapse">
        <ul class="navbar-nav mr-auto">
          <template is="dom-repeat" items="{{menuItems}}">
            <li class="nav-item">
              <a on-click="[[displayMenu]]" class="nav-link" href$="{{item.path}}" id$="{{item.class}}">
                <koa-item>
                  <koa-icon icon$='[[_getIcon(item.path)]]'></koa-icon>{{item.name}}
                </koa-item>
              </a>
            </li>
          </template>
        </ul>

      </div><!-- /.navbar-collapse -->
    </nav>

    <!-- Loading contained modules -->
    <concept-loader config="[[config]]" path=[[path]]> </concept-loader>

  </template>

  <script>
  class ModuleBootstrapmenu extends Polymer.Element {

    static get is() { return 'module-bootstrapmenu'; }

    static get properties() {
      return {
        scope: {
          type: Object,
          reflectToAttribute: false
        },
        path: {
          type: Object
        },
        modules: {
          type: Object,
          reflectToAttribute: false,
          value: ''
        },
        rootName: {
          type: String,
          value: ''
        },
        collapse: {
          type: Boolean,
          value: false
        },
        icon: {
          type: String,
          value: ''
        }
      };
    }


    static get observers() {
      return [
        '_dataReceived(modules, path, scope)'
      ]
    }

    _handleClick(e) {
      console.log(e);
    }

    _getIcon(path){
      return this.modules[path].icon;
    }

    _dataReceived(modules, path, scope) {
      this.rootName  = modules[path.path].name;
      this.icon      = modules[path.path].icon;
      this.menuItems = scope.menuItems;
    }

    constructor() {
      super();
      console.log('constructed');
    }

    ready() {
      super.ready();

      var menu = this.shadowRoot.querySelector('#menuCollapse');
      this.shadowRoot.querySelector('koa-icon-button').addEventListener('click', function(e) {
        console.log(e.target);
      });
      this.shadowRoot.querySelector('koa-toolbar').addEventListener('click', function(e) {
        menu.classList.toggle('collapse');
      });
      // menu.classList.toggle('collapse');

    }

    displayMenu() {
      console.log('display');
      // this.collapse = !this.collapse;
      var menu = this.shadowRoot.querySelector('#menuCollapse');
      menu.classList.toggle('collapse');
    }

    // attributeChangedCallback(attr) {
    //   console.log(attr);
    // }

  }

  customElements.define(ModuleBootstrapmenu.is, ModuleBootstrapmenu);

  </script>

</dom-module>
