<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="core-loader">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }
    </style>

    <div id="container">
    </div>
  </template>

  <script>
    Polymer({
      is: 'core-loader',

      properties: {
        route: {
          type: String
        },
        config: {
          type: String
        }
      },

      observers: [
        '_dataReceived(route,config)'
      ],

      _dataReceived: function(route,config) {
        route = JSON.parse(route);
        config = JSON.parse(config);
        var module = {"view": "module-splash.html", "identifier": "splash"};
        var scope = "";
        //Remove selected classes "selected"
        var items = this.shadowRoot.querySelectorAll('.selected');
        for (var i = 0; i < items.length; i++) {
            items[i].classList.remove("selected");
        }
        if (config.modules[route.path] && config.modules[route.path].identifier) {
          this._createElement(config.modules[route.path]);
        }


      },

      _createElement: function(module) {

        var dynamicEl = this.shadowRoot.querySelector("module-" + module.identifier);
        var scope = JSON.stringify(module.scope);
        var config = this.get('config');


        var route = JSON.stringify(this.route);
        if (this.shadowRoot.querySelector("module-" + module.identifier)) {
          dynamicEl.setAttribute("class", "selected");
          dynamicEl.setAttribute("scope", scope);
          dynamicEl.setAttribute("config", config);
          dynamicEl.setAttribute("route", route);
        }else {
          dynamicEl = document.createElement("module-" + module.identifier);
          dynamicEl.setAttribute("class", "selected");
          dynamicEl.setAttribute("scope", scope);
          dynamicEl.setAttribute("config", config);
          dynamicEl.setAttribute("route", route);
          Polymer.dom(this.$.container).appendChild(dynamicEl);
        }

        this._importElement(module);

      },


      _importElement: function(module) {
        // Import dynamic module
        var resolvedPageUrl = this.resolveUrl(module.view);
        this.importHref(resolvedPageUrl, null, null, true);
      }

    });
  </script>
</dom-module>
